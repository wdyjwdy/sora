<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="icon" href="/static/page/heart.svg" type="image/svg+xml" />
        <link rel="stylesheet" href="/static/page/style.css" />
        <title>ノート</title>
    </head>
    <body>
        <h1>ノート</h1>
        <div class="search">
            <div>
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="lucide lucide-search-icon lucide-search"
                >
                    <path d="m21 21-4.34-4.34" />
                    <circle cx="11" cy="11" r="8" />
                </svg>
            </div>
            <input type="text" id="search" enterkeyhint="search" />
        </div>
        <div class="tags">
            {{#categories}}
            <button>{{this}}</button>
            {{/categories}}
        </div>
        <div class="result"></div>
    </body>
    <script>
        const pages = {{{pages}}};
        const search = document.querySelector("#search");
        const tags = document.querySelector(".tags");
        const result = document.querySelector(".result");

        tags.addEventListener("click", function (event) {
          if (event.target.tagName === "BUTTON") {
            search.value = event.target.textContent;
            const enterEvent = new KeyboardEvent("keydown", {
              key: "Enter",
              code: "Enter",
              bubbles: true,
            });
            search.dispatchEvent(enterEvent);
          }
        });

        search.addEventListener("keydown", function (event) {
          if (event.code === "Enter") {
            result.replaceChildren();
            const query = this.value;
            pages
              .filter(({ title, category, alias = [] }) => {
                const keys = [title, category, ...alias]
                const regex = new RegExp(query, "i")
                return keys.some(x => regex.test(x))
              })
              .forEach((x, i, a) => {
                const prevCategory = a[i - 1]?.category;
                if (x.category !== prevCategory) {
                  result.insertAdjacentHTML("beforeend", `<p>${x.category}</p>`);
                }
                const item = `<a href="${x.url}">${x.title}</a>`
                result.insertAdjacentHTML("beforeend", item);
              });
            this.blur() // 关闭键盘
            search.blur()
          }
        });
    </script>
</html>
