<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="icon" href="/static/page/heart.svg" type="image/svg+xml" />
        <link rel="stylesheet" href="/static/page/common.css" />
        <title>ノート</title>
    </head>
    <body>
        <h1>ノート</h1>
        <input type="search" />
        <div class="tags">
            {{#categories}}
            <button>{{this}}</button>
            {{/categories}}
        </div>
        <div class="result"></div>
    </body>
    <script>
        const pages = {{{pages}}};
        const search = document.querySelector("input");
        const tags = document.querySelector(".tags");
        const result = document.querySelector(".result");

        tags.addEventListener("click", function (event) {
          if (event.target.tagName === "BUTTON") {
            search.value = event.target.textContent;
            const enterEvent = new KeyboardEvent("keydown", {
              key: "Enter",
              code: "Enter",
              bubbles: true,
            });
            search.dispatchEvent(enterEvent);
          }
        });

        search.addEventListener("keydown", function (event) {
          if (event.code === "Enter") {
            result.replaceChildren();
            const query = this.value;
            pages
              .filter(({ title, category, alias = [] }) => {
                const keys = [title, category, ...alias]
                const regex = new RegExp(query, "i")
                return keys.some(x => regex.test(x))
              })
              .forEach((x, i, a) => {
                const prevCategory = a[i - 1]?.category;
                if (x.category !== prevCategory) {
                  result.insertAdjacentHTML("beforeend", `<p>${x.category}</p>`);
                }
                const item = `<a href="${x.url}">${x.title}</a>`
                result.insertAdjacentHTML("beforeend", item);
              });
            setTimeout(() => this.blur(), 0);　// 关闭键盘
          }
        });
    </script>
    <style>
        input {
            margin: 20px 0;
            font-size: 1em;
            width: 100%;
            font-family: inherit;
            color: inherit;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            button {
                font-size: 1em;
                font-family: inherit;
            }
        }

        .result {
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            gap: 10px;

            p {
                border-bottom: 1px solid var(--gray-hard);
            }
        }
    </style>
</html>
